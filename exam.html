<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Typing-Speed</title>
    <link rel="stylesheet" href="index.css">
    <link rel="stylesheet" href="index-mobile.css">
    <script src="index.js"></script>
</head>

<body>
    <div class="container">
        <!-- Row 1: User Info & Timer -->
        <div class="row user-row">
            <div class="profile">
                <img class="profile-pic" src="https://randomuser.me/api/portraits/men/1.jpg" alt="Profile Picture" />
                <div class="user-details">
                    <p><strong>Name:</strong> <span id="userName"></span></p>
                    <p><strong>Email:</strong> <span id="userEmail"></span></p>
                    <p><strong>Hall Ticket:</strong> <span id="hallTicket"></span></p>
                </div>
            </div>
            <div class="timer">
                <span id="timer" class="timer-green">15:00</span>
            </div>
        </div>
        <script>
            window.onload = function () {
                document.getElementById('userName').textContent = localStorage.getItem('name') || '';
                document.getElementById('userEmail').textContent = localStorage.getItem('email') || '';
                document.getElementById('hallTicket').textContent = localStorage.getItem('hallticket') || '';
            }
        </script>

        <!-- Row 2: Typing Test Area -->
        <div class="row test-row">
            <h2>Typing Speed Test</h2>
            <div class="test-area">
                <div class="given-text" id="givenText"></div>
                <textarea id="typingArea" placeholder="Start typing here..." autocomplete="off" spellcheck="false"
                    disabled></textarea>
                <div id="wpmContainer">WPM: <span id="wpmValue">0</span></div>
                <div id="accuracy" hidden="true"></div>
                <script>
                        (function () {
                            let accuracy = 0;
                            const ta = document.getElementById('typingArea');
                            const wpmVal = document.getElementById('wpmValue');
                            let typingStartTime = null;

                            // Mark start time when the test starts
                            const startBtn = document.getElementById('startBtn');
                            if (startBtn) {
                                startBtn.addEventListener('click', () => {
                                    typingStartTime = Date.now();
                                    wpmVal.textContent = '0';
                                });
                            }

                            function calcWPM() {
                                if (!typingStartTime) typingStartTime = Date.now();
                                const elapsedMinutes = Math.max((Date.now() - typingStartTime) / 60000, 1 / 60);
                                const words = ta.value.trim().split(/\s+/).filter(Boolean).length;
                                const wpm = Math.floor(words / elapsedMinutes);
                                wpmVal.textContent = isFinite(wpm) && wpm >= 0 ? String(wpm) : '0';
                            }
                            // Accuracy calculation

                            function calcAccuracy() {
                                const ref = (document.getElementById('givenText')?.textContent || '').replace(/\s+/g, ' ').trim();
                                const typed = ta.value.replace(/\s+/g, ' ').trim();
                                let correct = 0;
                                const len = Math.min(typed.length, ref.length);
                                for (let i = 0; i < len; i++) {
                                    if (typed[i] === ref[i]) correct++;
                                }
                                accuracy = Math.round((correct / typed.length) * 100);
                                document.getElementById("accuracy").textContent = accuracy
                            }

                            ta.addEventListener('input', calcAccuracy);
                            ta.addEventListener('input', calcWPM);
                        })();
                </script>
            </div>
            <button id="startBtn">Start Test</button>
            <button id="submitBtn" disabled>Submit</button>
            <script>
                (function () {
                    const btn = document.getElementById('submitBtn');
                    btn.addEventListener('click', function () {
                        const testTakenTime = new Intl.DateTimeFormat('en-IN', {
                            timeZone: 'Asia/Kolkata',
                            year: 'numeric',
                            month: '2-digit',
                            day: '2-digit',
                            hour: '2-digit',
                            minute: '2-digit',
                            second: '2-digit',
                            hour12: false
                        }).format(new Date());
                        const get = k => localStorage.getItem(k) || '';
                        const name = (document.getElementById('userName')?.textContent || get('name') || get('userName')).trim();
                        const email = (document.getElementById('userEmail')?.textContent || get('email') || get('userEmail')).trim();
                        const hallTicket = (document.getElementById('hallTicket')?.textContent || get('hallticket') || get('hallTicket')).trim();
                        const wpm = parseInt(document.getElementById('wpmValue')?.textContent || '0', 10) || 0;
                        const accuracy = parseInt(document.getElementById('accuracy')?.textContent || '0', 10) || 0;

                        const key = 'typingResults';
                        let arr = [];
                        try {
                            const raw = localStorage.getItem(key);
                            arr = raw ? JSON.parse(raw) : [];
                            if (!Array.isArray(arr)) arr = [];
                        } catch { arr = []; }

                        arr.push({ name, email, hallTicket, wpm, accuracy, testTakenTime });
                        localStorage.setItem(key, JSON.stringify(arr));
                    });
                })();
            </script>
            <div id="thankYouMsg" class="hidden">Thank you for attending the exam.</div>
        </div>

        <!-- Row 3: Test Statistics -->
        <div class="row stats-row">
            <h2>Test Statistics</h2>
            <div id="stats">
                <p>Words Typed: <span id="wordsTyped">0</span></p>
                <p>Paragraph:</p>
                <div class="paragraph-box" id="paragraphBox"></div>
            </div>
        </div>
    </div>

    <style>
        html,
        body {
            height: 100%;
            width: 100%;
            margin: 0 !important;
            padding: 0 !important;
            box-sizing: border-box;
        }

        body {
            margin: 0 !important;
            padding: 0 !important;
            font-family: Arial, sans-serif;
            background: linear-gradient(135deg, #f5f5f5 0%, #ffe082 100%);
            min-height: 100vh;
            min-width: 100vw;
            width: 100vw;
            height: 100vh;
        }

        .container {
            display: flex;
            flex-direction: column;
            max-width: 100vw;
            min-width: 100vw;
            margin: 0 !important;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.08);
            border-radius: 0;
            background: transparent;
            overflow: hidden;
            width: 100vw;
        }

        .row {
            width: 100%;
            display: flex;
            align-items: center;
            box-sizing: border-box;
            padding: 24px 16px;
            background: rgba(255, 255, 255, 0.7);
        }

        .user-row {
            justify-content: space-between;
            border-bottom: 2px solid #ffe082;
            background: rgba(255, 255, 255, 0.8);
        }

        .profile {
            display: flex;
            align-items: center;
        }

        .profile-pic {
            width: 70px;
            height: 70px;
            border-radius: 50%;
            margin-right: 18px;
            object-fit: cover;
            background: #e0e0e0;
            display: block;
        }

        .user-details p {
            margin: 2px 0;
            font-size: 15px;
        }

        .timer {
            font-size: 2rem;
            font-weight: bold;
            margin-left: 24px;
        }

        .timer-green {
            color: #388e3c;
        }

        .timer-red {
            color: #d32f2f;
        }

        .test-row {
            flex-direction: column;
            align-items: stretch;
            background: rgba(255, 224, 130, 0.2);
            border-bottom: 2px solid #ffe082;
        }

        .test-area {
            width: 100%;
            max-width: 600px;
            margin: 0 auto 16px auto;
            display: flex;
            flex-direction: column;
            align-items: stretch;
        }

        .given-text {
            background: #fffde7;
            border: 1px solid #ffe082;
            border-radius: 8px;
            padding: 16px;
            margin-bottom: 16px;
            font-size: 1.1rem;
            user-select: none;
            pointer-events: none;
            max-height: 180px;
            overflow-y: auto;
        }

        #typingArea {
            min-height: 120px;
            font-size: 1.1rem;
            padding: 12px;
            border-radius: 8px;
            border: 1px solid #ffe082;
            resize: none;
            outline: none;
            background: #fff;
        }

        #startBtn,
        #submitBtn {
            margin-top: 12px;
            padding: 12px 32px;
            font-size: 1rem;
            background: #ffd54f;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            transition: background 0.2s;
            margin-right: 8px;
        }

        #startBtn:disabled,
        #submitBtn:disabled {
            background: #ffe082;
            cursor: not-allowed;
        }

        #startBtn:hover:enabled,
        #submitBtn:hover:enabled {
            background: #ffb300;
        }

        #thankYouMsg {
            margin-top: 24px;
            font-size: 1.2rem;
            color: #388e3c;
            text-align: center;
        }

        .hidden {
            display: none;
        }
    </style>

    <script>
        // User info from localStorage
        document.getElementById('userName').textContent = localStorage.getItem('userName') || '';
        document.getElementById('userEmail').textContent = localStorage.getItem('userEmail') || '';
        document.getElementById('hallTicket').textContent = localStorage.getItem('hallTicket') || '';

        // Paragraph
        const givenParagraph = `A new Union Tribal Affairs Ministry policy framework is a reminder that India’s
    conservation strategy is not a fortress conservation model but one in which protecting the country’s tigers
    is a social contract. The policy’s foremost virtue is reiteration that people living near or inside forests
    cannot be relocated until the Forest Rights Act (FRA) 2006 process has been completed, affirming that they
    are stakeholders, not trespassers. This view has sadly been falling out of favour with a government that
    is increasingly seeing forests solely for their climate utility and a judiciary keen to settle long-standing
    disputes. The policy casting relocation as an “exceptional” measure also overturns the 2024 National Tiger
    Conservation Authority directive to remove villages en masse from tiger reserves. Instead of treating humans
    and tigers as mutually exclusive, the framework promotes research and pilot projects on sustainable co-habitation
    that could help redefine tiger conservation through a more socially legitimate, and possibly more resilient model.
    Its invocation of the SC/ST (Prevention of Atrocities) Act for unlawful evictions and a three-tier system for
    redress also provide a safety net rarely available to these communities.`;
        document.getElementById('givenText').textContent = givenParagraph;
        document.getElementById('paragraphBox').textContent = givenParagraph;

        // Disable copy, paste, cut, context menu on given text and textarea
        const givenTextDiv = document.getElementById('givenText');
        const typingArea = document.getElementById('typingArea');
        ['copy', 'paste', 'cut', 'contextmenu'].forEach(evt => {
            givenTextDiv.addEventListener(evt, e => e.preventDefault());
            typingArea.addEventListener(evt, e => {
                if (evt !== 'contextmenu') e.preventDefault();
            });
        });
        // Prevent keyboard copy/paste/select all in textarea
        typingArea.addEventListener('keydown', function (e) {
            if ((e.ctrlKey || e.metaKey) && (e.key === 'v' || e.key === 'c' || e.key === 'x' || e.key === 'a')) {
                e.preventDefault();
            }
        });

        // Timer logic
        let totalSeconds = 15 * 60;
        let timerInterval = null;
        const timerSpan = document.getElementById('timer');
        function updateTimer() {
            const min = Math.floor(totalSeconds / 60);
            const sec = totalSeconds % 60;
            timerSpan.textContent = `${min.toString().padStart(2, '0')}:${sec.toString().padStart(2, '0')}`;
            if (totalSeconds <= 300) {
                timerSpan.classList.remove('timer-green');
                timerSpan.classList.add('timer-red');
            } else {
                timerSpan.classList.add('timer-green');
                timerSpan.classList.remove('timer-red');
            }
        }
        function startTimer() {
            updateTimer();
            timerInterval = setInterval(() => {
                totalSeconds--;
                updateTimer();
                if (totalSeconds <= 0) {
                    clearInterval(timerInterval);
                    submitTest();
                }
            }, 1000);
        }

        // Word count logic
        typingArea.addEventListener('input', () => {
            const words = typingArea.value.trim().split(/\s+/).filter(Boolean);
            document.getElementById('wordsTyped').textContent = words.length;
        });

        // Submit logic
        const submitBtn = document.getElementById('submitBtn');
        const thankYouMsg = document.getElementById('thankYouMsg');
        let testSubmitted = false;
        function submitTest() {
            if (testSubmitted) return;
            testSubmitted = true;
            typingArea.disabled = true;
            submitBtn.disabled = true;
            thankYouMsg.classList.remove('hidden');
            if (timerInterval) clearInterval(timerInterval);
        }
        submitBtn.addEventListener('click', submitTest);

        // Start button logic
        const startBtn = document.getElementById('startBtn');
        startBtn.addEventListener('click', function () {
            typingArea.disabled = false;
            typingArea.focus();
            startBtn.disabled = true;
            submitBtn.disabled = false;
            startTimer();
        });
    </script>

</body>

</html>